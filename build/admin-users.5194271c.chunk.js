"use strict";(self.webpackChunkapi_cms=self.webpackChunkapi_cms||[]).push([[5199],{94699:(S,l,t)=>{t.d(l,{Z:()=>D});var e=t(67294),s=t(45697),r=t.n(s),a=t(97132),c=t(28702),f=t.n(c),d=t(41363),m=t.n(d),E=t(95489),n=t.n(E);const v=({displayedFilters:x})=>{const[$,h]=(0,e.useState)(!1),{formatMessage:R}=(0,a.useIntl)(),T=(0,e.useRef)(),O=()=>{h(C=>!C)};return e.createElement(e.Fragment,null,e.createElement(c.Box,{paddingTop:1,paddingBottom:1},e.createElement(c.Button,{variant:"tertiary",ref:T,startIcon:e.createElement(d.Filter,null),onClick:O,size:"S"},R({id:"app.utils.filters",defaultMessage:"Filters"})),$&&e.createElement(E.FilterPopoverURLQuery,{displayedFilters:x,isVisible:$,onToggle:O,source:T})),e.createElement(E.FilterListURLQuery,{filtersSchema:x}))};v.propTypes={displayedFilters:r().arrayOf(r().shape({name:r().string.isRequired,metadatas:r().shape({label:r().string}),fieldSchema:r().shape({type:r().string})})).isRequired};const D=v},57338:(S,l,t)=>{t.d(l,{Z:()=>s});const s={firstname:"",lastname:"",email:"",roles:[]}},55867:(S,l,t)=>{t.d(l,{Z:()=>s});const s=[]},35097:(S,l,t)=>{t.r(l),t.d(l,{default:()=>Oe});var e=t(67294),s=t(95489),r=t(87751),a=t(28702),c=t(41363),f=t(49656),d=t(97132),m=t(23724),E=t(45697),n=t.n(E),v=t(38683);const D=({canDelete:u,headers:p,entriesToDelete:A,onClickDelete:M,onSelectRow:I,withMainAction:Y,withBulkActions:L,rows:B})=>{const{push:j,location:{pathname:V}}=(0,f.useHistory)(),{formatMessage:y}=(0,d.useIntl)();return e.createElement(a.Tbody,null,B.map(o=>{const N=A.findIndex(W=>W===o.id)!==-1;return e.createElement(a.Tr,{key:o.id,...(0,s.onRowClick)({fn:()=>j(`${V}/${o.id}`),condition:L})},Y&&e.createElement(a.Td,{...s.stopPropagation},e.createElement(a.BaseCheckbox,{"aria-label":y({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,v.Pp)(o.firstname,o.lastname)}),checked:N,onChange:()=>{I({name:o.id,value:!N})}})),p.map(({key:W,cellFormatter:b,name:z,...w})=>e.createElement(a.Td,{key:W},typeof b=="function"?b(o,{key:W,name:z,formatMessage:y,...w}):e.createElement(a.Typography,{textColor:"neutral800"},o[z]||"-"))),L&&e.createElement(a.Td,null,e.createElement(a.Flex,{justifyContent:"end"},e.createElement(a.IconButton,{onClick:()=>j(`${V}/${o.id}`),label:y({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,v.Pp)(o.firstname,o.lastname)}),noBorder:!0,icon:e.createElement(c.Pencil,null)}),u&&e.createElement(a.Box,{paddingLeft:1,...s.stopPropagation},e.createElement(a.IconButton,{onClick:()=>M(o.id),label:y({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,v.Pp)(o.firstname,o.lastname)}),noBorder:!0,icon:e.createElement(c.Trash,null)})))))}))};D.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},D.propTypes={canDelete:n().bool,entriesToDelete:n().array,headers:n().array.isRequired,onClickDelete:n().func,onSelectRow:n().func,rows:n().array,withBulkActions:n().bool,withMainAction:n().bool};const x=D;var $=t(94699),h=t(87462),R=t(15861),T=t(70885),O=t(64687),C=t.n(O),X=t(80831),k=t(81288);const ae=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]];var G=t(53209);const H=G.Ry().shape({firstname:G.Z_().trim().required(s.translatedErrors.required),lastname:G.Z_(),email:G.Z_().email(s.translatedErrors.email).required(s.translatedErrors.required),roles:G.IX().min(1,s.translatedErrors.required).required(s.translatedErrors.required)}),se={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}};var ne=function(){return window&&window.strapi&&window.strapi.isEE?t(97083).Z:t(57338).Z}(),re=function(){return window&&window.strapi&&window.strapi.isEE?t(810).Z:t(55867).Z}(),oe=function(){return window&&window.strapi&&window.strapi.isEE?t(12201).Z:t(31605).Z}(),U=function(p){var A=p.queryName,M=p.onToggle,I=(0,e.useState)("create"),Y=(0,T.Z)(I,2),L=Y[0],B=Y[1],j=(0,e.useState)(!1),V=(0,T.Z)(j,2),y=V[0],o=V[1],N=(0,e.useState)(null),W=(0,T.Z)(N,2),b=W[0],z=W[1],w=(0,m.useQueryClient)(),q=(0,d.useIntl)(),K=q.formatMessage,ee=(0,s.useNotification)(),te=(0,s.useOverlayBlocker)(),g=te.lockApp,pe=te.unlockApp,Ce=(0,s.useFetchClient)(),Ae=Ce.post,Le=(0,m.useMutation)(function(P){return Ae("/admin/users",P)},{onSuccess:function(F){return(0,R.Z)(C().mark(function Q(){var Z;return C().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return Z=F.data,z(Z.data.registrationToken),i.next=4,w.invalidateQueries(A);case 4:Se(),o(!1);case 6:case"end":return i.stop()}},Q)}))()},onError:function(F){throw o(!1),ee({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),F},onSettled:function(){pe()}}),ge=K({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),Be=function(){var P=(0,R.Z)(C().mark(function F(Q,Z){var J,i,ce;return C().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return J=Z.setErrors,g(),o(!0),_.prev=3,_.next=6,Le.mutateAsync(Q);case 6:_.next=12;break;case 8:_.prev=8,_.t0=_.catch(3),pe(),(_.t0===null||_.t0===void 0||(i=_.t0.response)===null||i===void 0||(ce=i.data)===null||ce===void 0?void 0:ce.error.message)==="Email already taken"&&J({email:_.t0.response.data.error.message});case 12:case"end":return _.stop()}},F,null,[[3,8]])}));return function(Q,Z){return P.apply(this,arguments)}}(),Se=function(){_e?B(_e):M()},ie=se[L],fe=ie.buttonSubmitLabel,de=ie.isDisabled,_e=ie.next,Re=L==="create"?e.createElement(a.Button,{type:"submit",loading:y},K(fe)):e.createElement(a.Button,{type:"button",loading:y,onClick:M},K(fe));return e.createElement(a.ModalLayout,{onClose:M,labelledBy:"title"},e.createElement(a.ModalHeader,null,e.createElement(a.Breadcrumbs,{label:ge},e.createElement(a.Crumb,null,ge))),e.createElement(X.Formik,{initialValues:ne,onSubmit:Be,validationSchema:H,validateOnChange:!1},function(P){var F=P.errors,Q=P.handleChange,Z=P.values;return e.createElement(s.Form,null,e.createElement(a.ModalBody,null,e.createElement(a.Stack,{spacing:6},L!=="create"&&e.createElement(oe,{registrationToken:b}),e.createElement(a.Box,null,e.createElement(a.Typography,{variant:"beta",as:"h2"},K({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})),e.createElement(a.Box,{paddingTop:4},e.createElement(a.Stack,{spacing:1},e.createElement(a.Grid,{gap:5},ae.map(function(J){return J.map(function(i){return e.createElement(a.GridItem,(0,h.Z)({key:i.name},i.size),e.createElement(s.GenericInput,(0,h.Z)({},i,{disabled:de,error:F[i.name],onChange:Q,value:Z[i.name]})))})}))))),e.createElement(a.Box,null,e.createElement(a.Typography,{variant:"beta",as:"h2"},K({id:"global.roles",defaultMessage:"User's role"})),e.createElement(a.Box,{paddingTop:4},e.createElement(a.Grid,{gap:5},e.createElement(a.GridItem,{col:6,xs:12},e.createElement(k.Z,{disabled:de,error:F.roles,onChange:Q,value:Z.roles})),re.map(function(J){return J.map(function(i){return e.createElement(a.GridItem,(0,h.Z)({key:i.name},i.size),e.createElement(s.GenericInput,(0,h.Z)({},i,{disabled:de,onChange:Q,value:Z[i.name]})))})})))))),e.createElement(a.ModalFooter,{startActions:e.createElement(a.Button,{variant:"tertiary",onClick:M,type:"button"},K({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:Re}))}))};U.propTypes={onToggle:n().func.isRequired,queryName:n().array.isRequired};const Me=U,le=({pagination:u})=>e.createElement(a.Box,{paddingTop:4},e.createElement(a.Flex,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(s.PageSizeURLQuery,null),e.createElement(s.PaginationURLQuery,{pagination:u})));le.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},le.propTypes={pagination:n().shape({page:n().number,pageCount:n().number,pageSize:n().number,total:n().number})};const ye=le,Pe=async(u,p)=>{const{get:A}=(0,s.getFetchClient)(),{data:{data:M}}=await A(`/admin/users${u}`);return p(),M},ve=async u=>{const{post:p}=(0,s.getFetchClient)();await p("/admin/users/batch-delete",{ids:u})},De=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],he=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:u},{formatMessage:p}){return e.createElement(a.Typography,{textColor:"neutral800"},u.map(A=>p({id:`Settings.permissions.users.${A.code}`,defaultMessage:A.name})).join(`,
`))}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:u},{formatMessage:p}){return e.createElement(a.Flex,null,e.createElement(s.Status,{isActive:u,variant:u?"success":"danger"}),e.createElement(a.Typography,{textColor:"neutral800"},p({id:u?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:u?"Active":"Inactive"})))}}],Te=()=>{const[u,p]=(0,e.useState)(!1),{allowedActions:{canCreate:A,canDelete:M,canRead:I}}=(0,s.useRBAC)(r.Z.settings.users),Y=(0,m.useQueryClient)(),L=(0,s.useNotification)(),{formatMessage:B}=(0,d.useIntl)(),{search:j}=(0,f.useLocation)();(0,s.useFocusWhenNavigate)();const{notifyStatus:V}=(0,a.useNotifyAT)(),y=["users",j],o=he.map(g=>({...g,metadatas:{...g.metadatas,label:B(g.metadatas.label)}})),N=B({id:"global.users",defaultMessage:"Users"}),W=()=>{V(B({id:"app.utils.notify.data-loaded",defaultMessage:"The {target} has loaded"},{target:N}))},{status:b,data:z,isFetching:w}=(0,m.useQuery)(y,()=>Pe(j,W),{enabled:I,keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError(){L({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),q=()=>{p(g=>!g)},K=(0,m.useMutation)(g=>ve(g),{async onSuccess(){await Y.invalidateQueries(y)},onError(g){g?.response?.data?.data?L({type:"warning",message:g.response.data.data}):L({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),ee=b!=="success"&&b!=="error"||b==="success"&&w,te=A?e.createElement(a.Button,{"data-testid":"create-user-button",onClick:q,startIcon:e.createElement(c.Envelop,null),size:"S"},B({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})):void 0;return e.createElement(a.Main,{"aria-busy":ee},e.createElement(s.SettingsPageTitle,{name:"Users"}),e.createElement(a.HeaderLayout,{primaryAction:te,title:N,subtitle:B({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),I&&e.createElement(a.ActionLayout,{startActions:e.createElement(e.Fragment,null,e.createElement(s.SearchURLQuery,{label:B({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:N})}),e.createElement($.Z,{displayedFilters:De}))}),e.createElement(a.ContentLayout,{canRead:I},!I&&e.createElement(s.NoPermissions,null),b==="error"&&e.createElement("div",null,"TODO: An error occurred"),I&&e.createElement(e.Fragment,null,e.createElement(s.DynamicTable,{contentType:"Users",isLoading:ee,onConfirmDeleteAll:K.mutateAsync,onConfirmDelete:g=>K.mutateAsync([g]),headers:o,rows:z?.results,withBulkActions:!0,withMainAction:M},e.createElement(x,{canDelete:M,headers:o,rows:z?.results||[],withBulkActions:!0,withMainAction:M})),e.createElement(ye,{pagination:z?.pagination}))),u&&e.createElement(Me,{onToggle:q,queryName:y}))},Oe=()=>e.createElement(s.CheckPagePermissions,{permissions:r.Z.settings.users.main},e.createElement(Te,null))},82464:(S,l,t)=>{t.d(l,{Z:()=>$});var e=t(67294),s=t(45697),r=t.n(s),a=t(28702),c=t.n(a),f=t(95489),d=t.n(f),m=t(41363),E=t.n(m),n=t(74855),v=t.n(n),D=t(97132);const x=({children:h,target:R})=>{const T=(0,f.useNotification)(),{formatMessage:O}=(0,D.useIntl)(),C=()=>{T({type:"info",message:{id:"notification.link-copied"}})},X=O({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return e.createElement(f.ContentBox,{endAction:e.createElement(n.CopyToClipboard,{onCopy:C,text:R},e.createElement(a.IconButton,{label:X,noBorder:!0,icon:e.createElement(m.Duplicate,null)})),title:R,titleEllipsis:!0,subtitle:h,icon:e.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};x.propTypes={children:r().oneOfType([r().element,r().string]).isRequired,target:r().string.isRequired};const $=x},31605:(S,l,t)=>{t.d(l,{Z:()=>m});var e=t(67294),s=t(97132),r=t(45697),a=t.n(r),c=t(63871),f=t(82464);const d=({registrationToken:E})=>{const{formatMessage:n}=(0,s.useIntl)(),v=`${window.location.origin}${c.Z}auth/register?registrationToken=${E}`;return e.createElement(f.Z,{target:v},n({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};d.defaultProps={registrationToken:""},d.propTypes={registrationToken:a().string};const m=d},81288:(S,l,t)=>{t.d(l,{Z:()=>C});var e=t(67294),s=t(45697),r=t.n(s),a=t(97132),c=t(28702),f=t.n(c),d=t(23724),m=t.n(d),E=t(27821),n=t(41363),v=t.n(n),D=t(95489),x=t.n(D);const $=E.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,h=E.default.div`
  animation: ${$} 2s infinite linear;
`,R=()=>e.createElement(h,null,e.createElement(n.Loader,null)),T=async()=>{const{get:X}=(0,D.getFetchClient)(),{data:k}=await X("/admin/roles");return k.data},O=({disabled:X,error:k,onChange:ue,value:ae})=>{const{status:G,data:me}=(0,d.useQuery)(["roles"],T,{staleTime:5e4}),{formatMessage:H}=(0,a.useIntl)(),Ee=k?H({id:k,defaultMessage:k}):"",se=H({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),ne=H({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),re=H({id:"app.components.Select.placeholder",defaultMessage:"Select"}),oe=G==="loading"?e.createElement(R,null):void 0;return e.createElement(c.Select,{id:"roles",disabled:X,error:Ee,hint:ne,label:se,name:"roles",onChange:U=>{ue({target:{name:"roles",value:U}})},placeholder:re,multi:!0,startIcon:oe,value:ae,withTags:!0,required:!0},(me||[]).map(U=>e.createElement(c.Option,{key:U.id,value:U.id},H({id:`global.${U.code}`,defaultMessage:U.name}))))};O.defaultProps={disabled:!1,error:void 0},O.propTypes={disabled:r().bool,error:r().string,onChange:r().func.isRequired,value:r().array.isRequired};const C=O},97083:(S,l,t)=>{t.d(l,{Z:()=>a});var e=t(57338);const s=strapi.features.isEnabled(strapi.features.SSO)?{useSSORegistration:!0}:{},a={...e.Z,...s}},810:(S,l,t)=>{t.d(l,{Z:()=>s});const s=strapi.features.isEnabled(strapi.features.SSO)?[[{intlLabel:{id:"Settings.permissions.users.form.sso",defaultMessage:"Connect with SSO"},hint:{id:"Settings.permissions.users.form.sso.description",defaultMessage:"When enabled (ON), users can login via SSO"},name:"useSSORegistration",type:"bool",size:{col:6,xs:12}}]]:[]},12201:(S,l,t)=>{t.d(l,{Z:()=>m});var e=t(67294),s=t(97132),r=t(45697),a=t.n(r),c=t(63871),f=t(82464);const d=({registrationToken:E})=>{const{formatMessage:n}=(0,s.useIntl)();return E?e.createElement(f.Z,{target:`${window.location.origin}${c.Z}auth/register?registrationToken=${E}`},n({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):e.createElement(f.Z,{target:`${window.location.origin}${c.Z}auth/login`},n({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};d.defaultProps={registrationToken:""},d.propTypes={registrationToken:a().string};const m=d}}]);
